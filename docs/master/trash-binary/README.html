<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nimrod. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>genieos trash command</title>
<style type="text/css">

body {
  color: black;
  background: white;
}

span.DecNumber {color: blue}
span.BinNumber {color: blue}
span.HexNumber {color: blue}
span.OctNumber {color: blue}
span.FloatNumber {color: blue}
span.Identifier  {color: black}
span.Keyword {font-weight: bold}
span.StringLit {color: blue}
span.LongStringLit {color: blue}
span.CharLit {color: blue}
span.EscapeSequence {color: black}
span.Operator {color: black}
span.Punctation {color: black}
span.Comment, span.LongComment {font-style:italic; color: green}
span.RegularExpression  {color: DarkViolet}
span.TagStart {color: DarkViolet}
span.TagEnd {color: DarkViolet}
span.Key  {color: blue}
span.Value  {color: black}
span.RawData {color: blue}
span.Assembler  {color: blue}
span.Preprocessor {color: DarkViolet}
span.Directive  {color: DarkViolet}
span.Command, span.Rule, span.Hyperlink, span.Label, span.Reference, 
span.Other  {color: black}

div.navigation {
  -moz-border-radius: 5px 5px 5px 5px;
  float: left; 
  width: 30%;
  margin: 0; padding: 0;
  border: 3px outset #7F7F7F;
  background-color: #7F7F7F;
}

div.navigation ul {
  list-style-type: none;
  padding-left: 1em;
}
div.navigation ul li a, div.navigation ul li a:visited {
  font-weight: bold;
  color: #FFFFFF;
  text-decoration: none;
}
div.navigation ul li a:hover {
  font-weight: bold;
  text-decoration: none;
  color: gold;
}

div.content {
  margin-left: 30%;
  padding: 0 1em;
  border-left: 4em;
}

dl.item dd, dl.item dd p {
  margin-top:3px;
}
dl.item dd pre {
  margin-left: 15pt;
  border: 0px;
}
dl.item dt, dl.item dt pre {
  margin:  20pt 0 0 5pt;
}

pre, span.tok {
  background-color: #F9F9F9;
  border-color: #C4C4C4;
  border-style: solid;
  border-width: 1px 1px 1px 2px;
  color: black;
  line-spacing: 110%;
  padding: 2px;
}

span.red {
  color: #A80000;
}

hr {background-color:#9D9D9D; border:0 none; color:#9D9D9D; height:1px; width:100%;}

/*
:Author: David Goodger
:Contact: goodger@python.org
:Date: Date: 2006-05-21 22:44:42 +0200 (Sun, 21 May 2006)
:Revision: Revision: 4564
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/
/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th { border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first { margin-top: 0 ! important }
.last, .with-subtitle { margin-bottom: 0 ! important }
.hidden { display: none }
a.toc-backref { text-decoration: none ; color: black }
blockquote.epigraph { margin: 2em 5em ; }
dl.docutils dd { margin-bottom: 0.5em }
div.abstract { margin: 2em 5em }
div.abstract p.topic-title { font-weight: bold ; text-align: center }
div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ; border: medium outset ; padding: 1em }
div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title { font-weight: bold ; font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title { color: red ; font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication { margin: 2em 5em ; text-align: center ; font-style: italic }
div.dedication p.topic-title { font-weight: bold ; font-style: normal }
div.figure { margin-left: 2em ; margin-right: 2em }
div.footer, div.header { clear: both; font-size: smaller }
div.line-block { display: block ; margin-top: 1em ; margin-bottom: 1em }
div.line-block div.line-block { margin-top: 0 ; margin-bottom: 0 ;
  margin-left: 1.5em }
div.sidebar { margin-left: 1em ; border: medium outset ;
  padding: 1em ; background-color: #ffffee ; /*width: 40% ;*/ float: right ;
  clear: right }

div.sidebar p.rubric { font-family: sans-serif ; font-size: medium }
div.system-messages { margin: 5em }
div.system-messages h1 { color: red }
div.system-message { border: medium outset ; padding: 1em }
div.system-message p.system-message-title { color: red ; font-weight: bold }
div.topic { margin: 2em;}
h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }
h1.title { text-align: center }
h2.subtitle { text-align: center }
/* hr.docutils { width: 75% } */
img.align-left { clear: left }
img.align-right { clear: right }
ol.simple, ul.simple { margin-bottom: 1em }
ol.arabic { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }
p.attribution { text-align: right ; margin-left: 50% }
p.caption { font-style: italic }
p.credits { font-style: italic ; font-size: smaller }
p.label { white-space: nowrap }
p.rubric { font-weight:bold;font-size:larger;color:maroon;text-align:center}
p.sidebar-title {font-family: sans-serif ;font-weight: bold ;font-size: larger }
p.sidebar-subtitle {font-family: sans-serif ; font-weight: bold }
p.topic-title {
font-weight: bold;
background-color: #6D6D6D;
border-bottom: 1px solid #000000;
border-top: 1px solid black;
color: white;
text-align: center;
margin: 0;
}
pre.address { margin-bottom: 0;margin-top:0;font-family:serif;font-size:100% }
pre.literal-block, pre.doctest-block {margin-left: 2em ;margin-right: 2em }
span.classifier {font-family: sans-serif;font-style: oblique }
span.classifier-delimiter {font-family: sans-serif;font-weight: bold }
span.interpreted {font-family: sans-serif }
span.option {white-space: nowrap }
span.pre {white-space: pre }
span.problematic {color: red }
span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation { border-left: solid 1px gray; margin-left: 1px }
table.docinfo {margin: 2em 4em }
table.docutils {margin-top: 0.5em;margin-bottom: 0.5em; border: 0 solid #9d9d9d; border-collapse: collapse; }
table.footnote {border-left: solid 1px black;margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {padding-left: 0.5em;padding-right: 0.5em;
  vertical-align: top;}

table.docutils td, table.docutils th { border-bottom:1px solid #9D9D9D; }
/* color: #4d4d4d} */

/* table.docutils td:hover, table.docinfo td:hover {color: #000000} */
  

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold;text-align: left;white-space: nowrap;padding-left: 0 }
  
table.docutils th
{
color: black;
font-weight:normal;
background-color: #E3E3E3;
border-top: 1px solid #1d1d1d;
border-bottom: 1px solid #1d1d1d;
}
  
h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {font-size: 100% }
ul.auto-toc { list-style-type: none }
/*a.reference { color: #E00000; font-weight:bold;}
a.reference:hover {color: #E00000;background-color: #ffff00;display: margin;
  font-weight:bold;}*/

</style>

</head>
<body>
<div class="document" id="documentId">
<h1 class="title">genieos trash command</h1>
<p>No, no, not that this is trash. As <a class="reference external" href="http://en.wikipedia.org/wiki/Kim_Hyo-yeon">Hyoyeon</a> correctly points out, this is just a MacOSX command line tool using <a class="reference external" href="../genieos.nim">the genieos module</a> for the <a class="reference external" href="http://nimrod-lang.org">Nimrod programming language</a>. This tool can be used instead of the typical <tt class="docutils literal"><span class="pre">rm</span></tt> command found on many Unix systems, and instead of vanishing your files it will move them to the recycle bin, even making the Dock's recycle bin sound (you can optionally disable this).</p>

<h1 id="installation-and-usage">Installation and usage</h1><p>If you have Nimrod and the <tt class="docutils literal"><span class="pre">genieos</span></tt> module, you can simply type:<pre>
nimrod c -d:release trash.nim</pre>
</p>
<p>This will generate a <tt class="docutils literal"><span class="pre">trash</span></tt> binary of more or less 150KB which you can put somewhere in your <tt class="docutils literal"><span class="pre">PATH</span></tt> and happily use. If you really care about size, you can use <a class="reference external" href="http://upx.sourceforge.net">the ultimate packer for executables</a> like <tt class="docutils literal"><span class="pre">upx --best trash</span></tt> to reduce it further to about 52KB. Oh, I nearly forgot.  For commandline parsing this command uses the <a class="reference external" href="https://github.com/gradha/argument_parser">argument_parser module</a>) which you previously have to install through <a class="reference external" href="https://github.com/nimrod-code/babel">Nimrod's babel package manager</a> typing:<pre>
babel install argument_parser</pre>
</p>

<h1 id="documentation">Documentation</h1><p>According to <a class="reference external" href="http://en.wikipedia.org/wiki/Tiffany_(South_Korean_singer)">Tiffany</a> there's not much documentation for this simple tool. You should run the command with the <tt class="docutils literal"><span class="pre">-h</span></tt> or <tt class="docutils literal"><span class="pre">--help</span></tt> parameters to see its options.</p>

<h1 id="benchmarks">Benchmarks</h1><p>Because a commandline tool for moving files to the recycle bin without unscientific benchmarks would be like a day without watching <a class="reference external" href="http://en.wikipedia.org/wiki/Kwon_Yuri">Yuri</a> dance, here's a comparison to other MacOSX programs with similar functionality: <a class="reference external" href="http://www.nightproductions.net/cli.htm">rmtrash</a>, <a class="reference external" href="https://github.com/albertz/helpers/blob/master/rm-trash.py">rm-trash.py</a> and <a class="reference external" href="http://www.dribin.org/dave/osx-trash/">osx-trash</a>.</p>
<p>Let's run our nimrod binary to set as baseline:<pre>
[0:gradha@amber.local:0] [/tmp]$ time (touch 1.delete; \
    mkdir 2.delete; trash ?.delete)
real	0m0.980s
user	0m0.076s
sys	0m0.060s</pre>
</p>
<p>Huh, so nearly a second to remove one file and a directory. Let's see how the Ruby script performs (Ruby's osx-trash package provides a <em>binary</em> with the same <tt class="docutils literal"><span class="pre">trash</span></tt> name so I only renamed it, no hard feelings):<pre>
[0:gradha@amber.local:0] [/tmp]$ time (touch 1.delete; \
    mkdir 2.delete; rubytrash ?.delete)
real	0m2.678s
user	0m0.665s
sys	0m0.174s</pre>
</p>
<p>Ugh, so it takes nearly three times as long. Ok, let's try the python version:<pre>
[0:gradha@amber.local:0] [/tmp]$ time (touch 1.delete; \
    mkdir 2.delete; ./rm-trash.py ?.delete)
real	0m0.636s
user	0m0.183s
sys	0m0.097s</pre>
</p>
<p>That's more like it, improving over our own nimrod version! For completeness let's run the objc implementation, which should be the fastest one, given that we are trying to execute an objc/Cocoa API here:<pre>
[0:gradha@amber.local:0] [/tmp]$ time (touch 1.delete; \
    mkdir 2.delete; ./rmtrash ?.delete)
real	0m0.077s
user	0m0.011s
sys	0m0.012s</pre>
</p>
<p>Yay, impressive performance. But wait a sec, I was listening to <a class="reference external" href="http://en.wikipedia.org/wiki/Im_Yoona">Yoona</a> singing a solo and noticed a lack of sounds over her beautiful voice! If you repeat these commands on your machine you should hear the ruby and nimrod version triggering the recycle bin sound but not so for the objc or python version.</p>
<p>Oh, look at this, if you actually read their implementation they are <strong>not using</strong> the proper recycle bin API, instead <tt class="docutils literal"><span class="pre">rm-trash</span></tt> is simply moving the files to the path where the MacOSX recycle bin just happens to be located, which is presumably bad and prone to breakage and doesn't trigger the user-friendly sound confirming the action. The python script is calling an objc API, but that API <cite>FSPathMoveObjectToTrashSync</cite> is deprecated and doesn't trigger the sound.</p>
<p>Well, that's sort of cheating. I don't want to avoid using the API like <tt class="docutils literal"><span class="pre">rm-trash</span></tt> since <a class="reference external" href="http://superuser.com/a/112586/10892">that doesn't update the .DS_Store file located in the .Trash folder</a>, but at least we can put ourselves more on equal ground by avoiding to play back the recycle bin sound with the silent <tt class="docutils literal"><span class="pre">-s</span></tt> parameter:<pre>
[0:gradha@amber.local:0] [/tmp]$ time (touch 1.delete; \
    mkdir 2.delete; trash -s ?.delete)
real	0m0.099s
user	0m0.058s
sys	0m0.026s</pre>
</p>
<p>Ah, that's much better. Without producing the sound (and waiting for it to play back) the nimrod version goes under 100ms, much closer to the 77ms of the cheating objc version. <strong>UPDATE:</strong> after <a class="reference external" href="https://github.com/gradha/genieos/issues/2">implementing sound playback in the background</a> the normal command returns much faster to the foreground, but the external process spawn still takes some milliseconds.</p>
<p>Ok, that's it. I won't be running this benchmarks in any way or form in the future since that could generate different results due to the CPU load of my machine and break my happiness. Simply sleep better knowing <a class="reference external" href="http://nimrod-lang.org">Nimrod is awesome</a>. </p>

<small>Last modified: 2015-01-17 20:21 UTC. Local time: 2015-01-17 21:21.
<div id="counter"></div>
</small>
<br>Rendered by lazy_rest 0.2.2.
</div>
</body>
<script type="text/javascript">
// Time difference code from http://stackoverflow.com/q/11479170/172690
function timeDifference(current, previous) {
    var msPerMinute = 60 * 1000;
    var msPerHour = msPerMinute * 60;
    var msPerDay = msPerHour * 24;
    var msPerMonth = msPerDay * 30;
    var msPerYear = msPerDay * 365;

    var elapsed = current - previous;

    if (elapsed < msPerMinute) {
         return Math.round(elapsed/1000) + ' seconds ago';
    } else if (elapsed < msPerHour) {
         return Math.round(elapsed/msPerMinute) + ' minutes ago';
    } else if (elapsed < msPerDay ) {
         return Math.round(elapsed/msPerHour ) + ' hours ago';
    } else if (elapsed < msPerMonth) {
         return 'approximately ' + Math.round(elapsed/msPerDay) + ' days ago';
    } else if (elapsed < msPerYear) {
         return 'approximately ' + Math.round(elapsed/msPerMonth) + ' months ago';
    } else {
         return 'approximately ' + Math.round(elapsed/msPerYear ) + ' years ago';
    }
}

// Timer base code taken from http://stackoverflow.com/a/11876480/172690
window.onload = function() {
    var fileTime = new Date(1421526085000);
	var ctr = document.getElementById("counter");

    function incrementCounter() {
		var nowTime = new Date();
		var relTime = timeDifference(nowTime, fileTime)
		ctr.innerHTML = relTime;
		// Update ourselves in the future, every five seconds.
		setTimeout(incrementCounter, 5000);
    }

    incrementCounter();
}
</script>

</html>
